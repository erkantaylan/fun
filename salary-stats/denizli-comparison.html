<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Denizli Maa≈ü Kar≈üƒ±la≈ütƒ±rmasƒ± - Y√∂netici Sunumu</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="data2023.js"></script>
    <script src="data2024.js"></script>
    <script src="data2025.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            min-height: 100vh;
            color: #e8e8e8;
            padding: 30px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .highlight-box {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(0, 212, 255, 0.1));
            border: 2px solid rgba(124, 58, 237, 0.5);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .highlight-box h2 {
            color: #7c3aed;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .key-finding {
            font-size: 2em;
            font-weight: bold;
            color: #00d4ff;
            margin: 15px 0;
        }

        .key-finding.negative {
            color: #f44336;
        }

        .explanation {
            color: #aaa;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .position-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .position-section h2 {
            color: #00d4ff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .position-section h2::before {
            content: 'üíº';
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-card.denizli {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 152, 0, 0.1));
            border-color: rgba(255, 193, 7, 0.4);
        }

        .stat-card h3 {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .city-name {
            font-size: 1.1em;
            color: #00d4ff;
            margin-bottom: 5px;
        }

        .stat-card.denizli .city-name {
            color: #ffc107;
        }

        .stat-card .value {
            font-size: 1.6em;
            font-weight: bold;
            color: #fff;
        }

        .stat-card .diff {
            margin-top: 8px;
            font-size: 0.9em;
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-block;
        }

        .stat-card .diff.negative {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .stat-card .diff.positive {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .chart-wrapper {
            height: 300px;
            position: relative;
        }

        .year-trend-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .year-trend-table th,
        .year-trend-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .year-trend-table th {
            background: rgba(124, 58, 237, 0.2);
            color: #7c3aed;
            font-weight: 600;
        }

        .year-trend-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .year-trend-table .denizli-row {
            background: rgba(255, 193, 7, 0.1);
        }

        .year-trend-table .denizli-row td {
            color: #ffc107;
            font-weight: 600;
        }

        .summary-box {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(0, 212, 255, 0.1));
            border: 2px solid rgba(76, 175, 80, 0.4);
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
        }

        .summary-box h2 {
            color: #4caf50;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-list {
            list-style: none;
            padding: 0;
        }

        .summary-list li {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .summary-list li::before {
            content: '‚úì';
            color: #4caf50;
            font-weight: bold;
            font-size: 1.2em;
        }

        .summary-list li:last-child {
            border-bottom: none;
        }

        .action-text {
            background: linear-gradient(135deg, #f44336, #ff9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            font-size: 1.3em;
            text-align: center;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 60px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(124, 58, 237, 0.2);
            border-top-color: #7c3aed;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .nav-links {
            text-align: center;
            margin-bottom: 30px;
        }

        .nav-links a {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: #00d4ff;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin: 0 10px;
            transition: background 0.2s;
        }

        .nav-links a:hover {
            background: rgba(0, 212, 255, 0.2);
        }

        .filter-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .filter-btn.active {
            background: rgba(100, 116, 139, 0.4);
            border-color: #64748b;
            color: #fff;
        }

        .prediction-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding: 15px 25px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .prediction-controls span {
            color: #ffc107;
        }

        .prediction-controls input {
            background: #2a2a4a;
            border: 1px solid #64748b;
            color: #fff;
            padding: 8px;
            border-radius: 6px;
        }

        .prediction-controls button {
            background: #ffc107;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .prediction-controls button:hover {
            background: #ffca28;
        }

        .prediction-note {
            color: #888 !important;
            font-size: 0.85em;
        }

        @media print {
            body {
                background: #fff;
                color: #000;
            }

            .nav-links,
            .filter-row,
            .prediction-controls {
                display: none;
            }

            .stat-card,
            .position-section,
            .highlight-box,
            .summary-box {
                break-inside: avoid;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üéØ Denizli Maa≈ü Kar≈üƒ±la≈ütƒ±rma Raporu</h1>
        <p class="subtitle">T√ºrkiye Yazƒ±lƒ±m Sekt√∂r√º - B√ºy√ºk ≈ûehirler ile Kar≈üƒ±la≈ütƒ±rmalƒ± Analiz</p>

        <div class="nav-links">
            <a href="salary-analysis.html">‚Üê Genel Analiz</a>
            <a href="median-analysis.html">Medyan Analizi ‚Üí</a>
        </div>

        <div class="filter-row">
            <button class="filter-btn" data-year="2023">2023</button>
            <button class="filter-btn" data-year="2024">2024</button>
            <button class="filter-btn" data-year="2025">2025</button>
            <button class="filter-btn active" data-year="2026">2026 (Tahmin)</button>
        </div>

        <div class="prediction-controls" id="predictionControls">
            <span>2026 Maa≈ü Artƒ±≈ü Tahmini:</span>
            <input type="number" id="predictionPercent" value="28" min="0" max="200"
                style="width: 70px; text-align: center;">
            <span>%</span>
            <button id="applyPrediction">Uygula</button>
            <span class="prediction-note">(2025 verilerine uygulanƒ±r)</span>
        </div>

        <div class="loading" id="loadingSection">
            <div class="spinner"></div>
            <p>Veriler y√ºkleniyor...</p>
        </div>

        <div id="contentSection" style="display: none;">

            <!-- Team/Tech Lead Section -->
            <div class="position-section">
                <h2>Team Lead / Tech Lead</h2>
                <div class="stats-row" id="leadStats"></div>
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="leadChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Back-end Developer Section -->
            <div class="position-section">
                <h2>Back-end Developer</h2>
                <div class="stats-row" id="backendStats"></div>
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="backendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Full Stack Developer Section -->
            <div class="position-section">
                <h2>Full Stack Developer</h2>
                <div class="stats-row" id="fullstackStats"></div>
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="fullstackChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Year by Year Comparison Table -->
            <div class="position-section">
                <h2>üìä Yƒ±llara G√∂re Denizli Maa≈ü Deƒüi≈üimi</h2>
                <table class="year-trend-table" id="yearTrendTable">
                    <thead>
                        <tr>
                            <th>Pozisyon</th>
                            <th>2023</th>
                            <th>2024</th>
                            <th>2025</th>
                            <th>Artƒ±≈ü (2023‚Üí2025)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

        </div>
    </div>

    <script>
        let allData = [];
        let charts = {};
        let selectedYear = '2026';
        let predictionPercent = 28;

        const targetPositions = [
            { key: 'backend', names: ['Back-end Developer', 'Backend Developer'], label: 'Back-end Developer' },
            { key: 'fullstack', names: ['Full Stack Developer', 'Fullstack Developer', 'Full-Stack Developer'], label: 'Full Stack Developer' },
            { key: 'lead', names: ['Team Lead', 'Tech Lead', 'Technical Lead', 'Team / Tech Lead'], label: 'Team/Tech Lead' }
        ];

        const targetCities = ['Denizli', 'Istanbul', 'Ankara', 'Izmir', 'Antalya', 'Kocaeli', 'Bursa', 'Mugla'];

        // Chart colors - clean 2-color scheme
        const DENIZLI_COLOR = '#ffc107';
        const OTHER_COLOR = '#64748b';

        const dataSources = {
            2023: () => typeof data2023 !== 'undefined' ? data2023 : null,
            2024: () => typeof data2024 !== 'undefined' ? data2024 : null,
            2025: () => typeof data2025 !== 'undefined' ? data2025 : null
        };

        function normalizeCity(city) {
            if (!city) return '';
            city = city.trim();
            if (city.startsWith('*')) return null;
            const normalizations = {
                'ƒ∞stanbul': 'Istanbul', 'istanbul': 'Istanbul', 'ISTANBUL': 'Istanbul',
                'ƒ∞ZMƒ∞R': 'Izmir', 'ƒ∞zmir': 'Izmir', 'izmir': 'Izmir',
                'MUƒûLA': 'Mugla', 'Muƒüla': 'Mugla', 'mugla': 'Mugla',
                'ESKƒ∞≈ûEHƒ∞R': 'Eskisehir', 'Eski≈üehir': 'Eskisehir'
            };
            return normalizations[city] || city;
        }

        function normalizePosition(position) {
            if (!position) return '';
            return position.trim().replace(/\s+/g, ' ');
        }

        function parseSalary(salaryStr) {
            if (!salaryStr) return null;
            const parts = salaryStr.replace(/\./g, '').split(' - ');
            if (parts.length === 2) {
                return (parseInt(parts[0]) + parseInt(parts[1])) / 2;
            }
            return parseInt(salaryStr.replace(/\./g, ''));
        }

        function isTL(currency) {
            if (!currency) return false;
            return currency.includes('T√ºrk Liras') || currency.includes('Turk Liras') ||
                currency.includes('TL') || currency.includes('‚Ç∫');
        }

        function generate2026Predictions() {
            // Remove existing 2026 predictions
            allData = allData.filter(d => d._year !== 2026);

            // Get 2025 data and create predictions
            const data2025Records = allData.filter(d => d._year === 2025);
            const multiplier = 1 + (predictionPercent / 100);

            data2025Records.forEach(record => {
                const predicted = { ...record };
                predicted._year = 2026;
                predicted._salary = record._salary * multiplier;
                predicted._isPrediction = true;
                allData.push(predicted);
            });
        }

        function loadAllData() {
            allData = [];
            for (const [year, getData] of Object.entries(dataSources)) {
                try {
                    const json = getData();
                    if (json) {
                        const records = json.RECORDS || json;
                        records.forEach(record => {
                            record._year = parseInt(year);
                            record._salary = parseSalary(record.salary);
                            record._city = normalizeCity(record.city);
                            record._position = normalizePosition(record.position);
                            record._isTL = isTL(record.currency);
                            allData.push(record);
                        });
                    }
                } catch (e) {
                    console.error(`Error loading ${year}:`, e);
                }
            }

            generate2026Predictions();
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('contentSection').style.display = 'block';
            updateAnalysis();
        }

        function getFilteredData() {
            return allData.filter(d => {
                if (selectedYear !== 'all' && d._year !== parseInt(selectedYear)) return false;
                if (!d._isTL) return false;
                if (!d._salary || !d._city) return false;
                return true;
            });
        }

        function matchesPosition(record, positionConfig) {
            const pos = record._position?.toLowerCase() || '';
            return positionConfig.names.some(name => pos.includes(name.toLowerCase()));
        }

        function getCityPositionStats(data, city, positionConfig) {
            const filtered = data.filter(d => d._city === city && matchesPosition(d, positionConfig));
            if (filtered.length === 0) return null;
            const salaries = filtered.map(d => d._salary);
            return {
                count: filtered.length,
                avg: Math.round(salaries.reduce((a, b) => a + b, 0) / salaries.length),
                min: Math.min(...salaries),
                max: Math.max(...salaries)
            };
        }

        function formatCurrency(value) {
            if (!value) return '-';
            return Math.round(value).toLocaleString('tr-TR') + ' TL';
        }

        function updateAnalysis() {
            const data = getFilteredData();
            updatePositionSection('backend', 'backendStats', 'backendChart', data, targetPositions[0]);
            updatePositionSection('fullstack', 'fullstackStats', 'fullstackChart', data, targetPositions[1]);
            updatePositionSection('lead', 'leadStats', 'leadChart', data, targetPositions[2]);
            updateYearTrendTable();
        }

        function updatePositionSection(key, statsId, chartId, data, positionConfig) {
            const container = document.getElementById(statsId);
            container.innerHTML = '';

            const denizliStats = getCityPositionStats(data, 'Denizli', positionConfig);
            const denizliAvg = denizliStats?.avg || 0;

            targetCities.forEach(city => {
                const stats = getCityPositionStats(data, city, positionConfig);
                const isDenizli = city === 'Denizli';

                let diffHtml = '';
                if (stats && denizliAvg && !isDenizli) {
                    const diffPercent = ((stats.avg - denizliAvg) / denizliAvg * 100).toFixed(1);
                    const diffClass = diffPercent > 0 ? 'negative' : 'positive';
                    diffHtml = `<div class="diff ${diffClass}">${diffPercent > 0 ? '+' : ''}${diffPercent}% fark</div>`;
                }

                container.innerHTML += `
                    <div class="stat-card ${isDenizli ? 'denizli' : ''}">
                        <h3>${stats ? stats.count + ' kayƒ±t' : 'Veri yok'}</h3>
                        <div class="city-name">${city}</div>
                        <div class="value">${stats ? formatCurrency(stats.avg) : '-'}</div>
                        ${diffHtml}
                    </div>
                `;
            });

            // Update chart
            if (charts[key]) charts[key].destroy();

            const cityData = targetCities.map(city => {
                const stats = getCityPositionStats(data, city, positionConfig);
                return stats?.avg || 0;
            });

            charts[key] = new Chart(document.getElementById(chartId), {
                type: 'bar',
                data: {
                    labels: targetCities,
                    datasets: [{
                        label: positionConfig.label + ' Ortalama Maa≈ü',
                        data: cityData,
                        backgroundColor: targetCities.map(c => c === 'Denizli' ? DENIZLI_COLOR : OTHER_COLOR),
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => formatCurrency(ctx.raw)
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#888', callback: v => v.toLocaleString('tr-TR') },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: { ticks: { color: '#888' }, grid: { display: false } }
                    }
                }
            });
        }

        function updateYearTrendTable() {
            const tbody = document.querySelector('#yearTrendTable tbody');
            tbody.innerHTML = '';

            targetPositions.forEach(posConfig => {
                const years = [2023, 2024, 2025];
                const yearAvgs = years.map(year => {
                    const yearData = allData.filter(d => d._year === year && d._isTL && d._city === 'Denizli' && matchesPosition(d, posConfig));
                    if (yearData.length === 0) return null;
                    return Math.round(yearData.reduce((a, b) => a + b._salary, 0) / yearData.length);
                });

                let growthHtml = '-';
                if (yearAvgs[0] && yearAvgs[2]) {
                    const growth = ((yearAvgs[2] - yearAvgs[0]) / yearAvgs[0] * 100).toFixed(1);
                    growthHtml = `<span style="color: ${growth > 0 ? '#4caf50' : '#f44336'}">%${growth}</span>`;
                }

                tbody.innerHTML += `
                    <tr class="denizli-row">
                        <td>${posConfig.label}</td>
                        <td>${yearAvgs[0] ? formatCurrency(yearAvgs[0]) : '-'}</td>
                        <td>${yearAvgs[1] ? formatCurrency(yearAvgs[1]) : '-'}</td>
                        <td>${yearAvgs[2] ? formatCurrency(yearAvgs[2]) : '-'}</td>
                        <td>${growthHtml}</td>
                    </tr>
                `;
            });
        }


        // Event listeners
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedYear = this.dataset.year;

                // Show/hide prediction controls
                const predControls = document.getElementById('predictionControls');
                predControls.style.display = selectedYear === '2026' ? 'flex' : 'none';

                updateAnalysis();
            });
        });

        // Prediction controls
        document.getElementById('applyPrediction').addEventListener('click', () => {
            predictionPercent = parseFloat(document.getElementById('predictionPercent').value) || 30;
            generate2026Predictions();
            updateAnalysis();
        });

        document.getElementById('predictionPercent').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('applyPrediction').click();
            }
        });

        // Load data on page load
        window.addEventListener('DOMContentLoaded', loadAllData);
    </script>
</body>

</html>