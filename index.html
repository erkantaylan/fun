<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>3B Yılan Oyunu</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: sans-serif;
            z-index: 1;
        }
    </style>
</head>
<body>
<div id="info">Yön Tuşlarıyla Oyna | Skor: <span id="score">0</span></div>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    let gridSize = 20;
    let cubeSize = 1;
    let snake = [{ x: 0, y: 0, z: 0 }];
    let direction = { x: 1, y: 0, z: 0 };
    let nextDir = { x: 1, y: 0, z: 0 };
    let score = 0;

    let snakeMeshes = [];
    let foodMesh = null;
    let food = { x: 5, y: 0, z: 0 };

    // Materials
    const snakeMat = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
    const foodMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });

    const light = new THREE.PointLight(0xffffff, 1);
    light.position.set(10, 10, 10);
    scene.add(light);

    const ambient = new THREE.AmbientLight(0x404040);
    scene.add(ambient);

    function drawCube(x, y, z, mat) {
        const geo = new THREE.BoxGeometry(cubeSize, cubeSize, cubeSize);
        const cube = new THREE.Mesh(geo, mat);
        cube.position.set(x, y, z);
        scene.add(cube);
        return cube;
    }

    function drawSnake() {
        snakeMeshes.forEach(m => scene.remove(m));
        snakeMeshes = [];
        for (let part of snake) {
            let cube = drawCube(part.x, part.y, part.z, snakeMat);
            snakeMeshes.push(cube);
        }
    }

    function drawFood() {
        if (foodMesh) scene.remove(foodMesh);
        foodMesh = drawCube(food.x, food.y, food.z, foodMat);
    }

    function placeFood() {
        food.x = Math.floor(Math.random() * gridSize - gridSize / 2);
        food.y = 0;
        food.z = Math.floor(Math.random() * gridSize - gridSize / 2);
    }

    function update() {
        direction = nextDir;
        const head = {
            x: snake[0].x + direction.x,
            y: snake[0].y + direction.y,
            z: snake[0].z + direction.z
        };

        // Sınır kontrolü
        if (Math.abs(head.x) > gridSize/2 || Math.abs(head.z) > gridSize/2 ||
            snake.some(s => s.x === head.x && s.z === head.z)) {
            alert("Oyun Bitti! Skor: " + score);
            location.reload();
        }

        snake.unshift(head);

        if (head.x === food.x && head.z === food.z) {
            score++;
            document.getElementById("score").textContent = score;
            placeFood();
            drawFood();
        } else {
            snake.pop();
        }

        drawSnake();
    }

    document.addEventListener("keydown", e => {
        switch (e.key) {
            case "ArrowUp": if (direction.z !== -1) nextDir = { x: 0, y: 0, z: -1 }; break;
            case "ArrowDown": if (direction.z !== 1) nextDir = { x: 0, y: 0, z: 1 }; break;
            case "ArrowLeft": if (direction.x !== 1) nextDir = { x: -1, y: 0, z: 0 }; break;
            case "ArrowRight": if (direction.x !== -1) nextDir = { x: 1, y: 0, z: 0 }; break;
        }
    });

    camera.position.set(0, 15, 15);
    camera.lookAt(0, 0, 0);

    placeFood();
    drawFood();

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }

    animate();
    setInterval(update, 200);
</script>
</body>
</html>
